import{h as t,r as e,c as i,g as r,H as s}from"./p-a07ebebf.js";const n=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var f=[];var o=[];var h=typeof Uint8Array!=="undefined"?Uint8Array:Array;var a=false;function u(){a=true;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var e=0,i=t.length;e<i;++e){f[e]=t[e];o[t.charCodeAt(e)]=e}o["-".charCodeAt(0)]=62;o["_".charCodeAt(0)]=63}function c(t){if(!a){u()}var e,i,r,s,n,f;var c=t.length;if(c%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}n=t[c-2]==="="?2:t[c-1]==="="?1:0;f=new h(c*3/4-n);r=n>0?c-4:c;var l=0;for(e=0,i=0;e<r;e+=4,i+=3){s=o[t.charCodeAt(e)]<<18|o[t.charCodeAt(e+1)]<<12|o[t.charCodeAt(e+2)]<<6|o[t.charCodeAt(e+3)];f[l++]=s>>16&255;f[l++]=s>>8&255;f[l++]=s&255}if(n===2){s=o[t.charCodeAt(e)]<<2|o[t.charCodeAt(e+1)]>>4;f[l++]=s&255}else if(n===1){s=o[t.charCodeAt(e)]<<10|o[t.charCodeAt(e+1)]<<4|o[t.charCodeAt(e+2)]>>2;f[l++]=s>>8&255;f[l++]=s&255}return f}function l(t){return f[t>>18&63]+f[t>>12&63]+f[t>>6&63]+f[t&63]}function b(t,e,i){var r;var s=[];for(var n=e;n<i;n+=3){r=(t[n]<<16)+(t[n+1]<<8)+t[n+2];s.push(l(r))}return s.join("")}function $(t){if(!a){u()}var e;var i=t.length;var r=i%3;var s="";var n=[];var o=16383;for(var h=0,c=i-r;h<c;h+=o){n.push(b(t,h,h+o>c?c:h+o))}if(r===1){e=t[i-1];s+=f[e>>2];s+=f[e<<4&63];s+="=="}else if(r===2){e=(t[i-2]<<8)+t[i-1];s+=f[e>>10];s+=f[e>>4&63];s+=f[e<<2&63];s+="="}n.push(s);return n.join("")}function d(t,e,i,r,s){var n,f;var o=s*8-r-1;var h=(1<<o)-1;var a=h>>1;var u=-7;var c=i?s-1:0;var l=i?-1:1;var b=t[e+c];c+=l;n=b&(1<<-u)-1;b>>=-u;u+=o;for(;u>0;n=n*256+t[e+c],c+=l,u-=8){}f=n&(1<<-u)-1;n>>=-u;u+=r;for(;u>0;f=f*256+t[e+c],c+=l,u-=8){}if(n===0){n=1-a}else if(n===h){return f?NaN:(b?-1:1)*Infinity}else{f=f+Math.pow(2,r);n=n-a}return(b?-1:1)*f*Math.pow(2,n-r)}function w(t,e,i,r,s,n){var f,o,h;var a=n*8-s-1;var u=(1<<a)-1;var c=u>>1;var l=s===23?Math.pow(2,-24)-Math.pow(2,-77):0;var b=r?0:n-1;var $=r?1:-1;var d=e<0||e===0&&1/e<0?1:0;e=Math.abs(e);if(isNaN(e)||e===Infinity){o=isNaN(e)?1:0;f=u}else{f=Math.floor(Math.log(e)/Math.LN2);if(e*(h=Math.pow(2,-f))<1){f--;h*=2}if(f+c>=1){e+=l/h}else{e+=l*Math.pow(2,1-c)}if(e*h>=2){f++;h/=2}if(f+c>=u){o=0;f=u}else if(f+c>=1){o=(e*h-1)*Math.pow(2,s);f=f+c}else{o=e*Math.pow(2,c-1)*Math.pow(2,s);f=0}}for(;s>=8;t[i+b]=o&255,b+=$,o/=256,s-=8){}f=f<<s|o;a+=s;for(;a>0;t[i+b]=f&255,b+=$,f/=256,a-=8){}t[i+b-$]|=d*128}var v={}.toString;var g=Array.isArray||function(t){return v.call(t)=="[object Array]"};
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var p=50;E.TYPED_ARRAY_SUPPORT=n.TYPED_ARRAY_SUPPORT!==undefined?n.TYPED_ARRAY_SUPPORT:true;function y(){return E.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function m(t,e){if(y()<e){throw new RangeError("Invalid typed array length")}if(E.TYPED_ARRAY_SUPPORT){t=new Uint8Array(e);t.__proto__=E.prototype}else{if(t===null){t=new E(e)}t.length=e}return t}function E(t,e,i){if(!E.TYPED_ARRAY_SUPPORT&&!(this instanceof E)){return new E(t,e,i)}if(typeof t==="number"){if(typeof e==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return B(this,t)}return k(this,t,e,i)}E.poolSize=8192;E._augment=function(t){t.__proto__=E.prototype;return t};function k(t,e,i,r){if(typeof e==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&e instanceof ArrayBuffer){return R(t,e,i,r)}if(typeof e==="string"){return M(t,e,i)}return U(t,e)}E.from=function(t,e,i){return k(null,t,e,i)};if(E.TYPED_ARRAY_SUPPORT){E.prototype.__proto__=Uint8Array.prototype;E.__proto__=Uint8Array}function x(t){if(typeof t!=="number"){throw new TypeError('"size" argument must be a number')}else if(t<0){throw new RangeError('"size" argument must not be negative')}}function A(t,e,i,r){x(e);if(e<=0){return m(t,e)}if(i!==undefined){return typeof r==="string"?m(t,e).fill(i,r):m(t,e).fill(i)}return m(t,e)}E.alloc=function(t,e,i){return A(null,t,e,i)};function B(t,e){x(e);t=m(t,e<0?0:_(e)|0);if(!E.TYPED_ARRAY_SUPPORT){for(var i=0;i<e;++i){t[i]=0}}return t}E.allocUnsafe=function(t){return B(null,t)};E.allocUnsafeSlow=function(t){return B(null,t)};function M(t,e,i){if(typeof i!=="string"||i===""){i="utf8"}if(!E.isEncoding(i)){throw new TypeError('"encoding" must be a valid string encoding')}var r=T(e,i)|0;t=m(t,r);var s=t.write(e,i);if(s!==r){t=t.slice(0,s)}return t}function N(t,e){var i=e.length<0?0:_(e.length)|0;t=m(t,i);for(var r=0;r<i;r+=1){t[r]=e[r]&255}return t}function R(t,e,i,r){if(i<0||e.byteLength<i){throw new RangeError("'offset' is out of bounds")}if(e.byteLength<i+(r||0)){throw new RangeError("'length' is out of bounds")}if(i===undefined&&r===undefined){e=new Uint8Array(e)}else if(r===undefined){e=new Uint8Array(e,i)}else{e=new Uint8Array(e,i,r)}if(E.TYPED_ARRAY_SUPPORT){t=e;t.__proto__=E.prototype}else{t=N(t,e)}return t}function U(t,e){if(I(e)){var i=_(e.length)|0;t=m(t,i);if(t.length===0){return t}e.copy(t,0,0,i);return t}if(e){if(typeof ArrayBuffer!=="undefined"&&e.buffer instanceof ArrayBuffer||"length"in e){if(typeof e.length!=="number"||$t(e.length)){return m(t,0)}return N(t,e)}if(e.type==="Buffer"&&g(e.data)){return N(t,e.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function _(t){if(t>=y()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+y().toString(16)+" bytes")}return t|0}E.isBuffer=dt;function I(t){return!!(t!=null&&t._isBuffer)}E.compare=function t(e,i){if(!I(e)||!I(i)){throw new TypeError("Arguments must be Buffers")}if(e===i)return 0;var r=e.length;var s=i.length;for(var n=0,f=Math.min(r,s);n<f;++n){if(e[n]!==i[n]){r=e[n];s=i[n];break}}if(r<s)return-1;if(s<r)return 1;return 0};E.isEncoding=function t(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};E.concat=function t(e,i){if(!g(e)){throw new TypeError('"list" argument must be an Array of Buffers')}if(e.length===0){return E.alloc(0)}var r;if(i===undefined){i=0;for(r=0;r<e.length;++r){i+=e[r].length}}var s=E.allocUnsafe(i);var n=0;for(r=0;r<e.length;++r){var f=e[r];if(!I(f)){throw new TypeError('"list" argument must be an Array of Buffers')}f.copy(s,n);n+=f.length}return s};function T(t,e){if(I(t)){return t.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)){return t.byteLength}if(typeof t!=="string"){t=""+t}var i=t.length;if(i===0)return 0;var r=false;for(;;){switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case undefined:return at(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return lt(t).length;default:if(r)return at(t).length;e=(""+e).toLowerCase();r=true}}}E.byteLength=T;function V(t,e,i){var r=false;if(e===undefined||e<0){e=0}if(e>this.length){return""}if(i===undefined||i>this.length){i=this.length}if(i<=0){return""}i>>>=0;e>>>=0;if(i<=e){return""}if(!t)t="utf8";while(true){switch(t){case"hex":return K(this,e,i);case"utf8":case"utf-8":return L(this,e,i);case"ascii":return H(this,e,i);case"latin1":case"binary":return Z(this,e,i);case"base64":return J(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase();r=true}}}E.prototype._isBuffer=true;function j(t,e,i){var r=t[e];t[e]=t[i];t[i]=r}E.prototype.swap16=function t(){var e=this.length;if(e%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<e;i+=2){j(this,i,i+1)}return this};E.prototype.swap32=function t(){var e=this.length;if(e%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<e;i+=4){j(this,i,i+3);j(this,i+1,i+2)}return this};E.prototype.swap64=function t(){var e=this.length;if(e%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<e;i+=8){j(this,i,i+7);j(this,i+1,i+6);j(this,i+2,i+5);j(this,i+3,i+4)}return this};E.prototype.toString=function t(){var e=this.length|0;if(e===0)return"";if(arguments.length===0)return L(this,0,e);return V.apply(this,arguments)};E.prototype.equals=function t(e){if(!I(e))throw new TypeError("Argument must be a Buffer");if(this===e)return true;return E.compare(this,e)===0};E.prototype.inspect=function t(){var e="";var i=p;if(this.length>0){e=this.toString("hex",0,i).match(/.{2}/g).join(" ");if(this.length>i)e+=" ... "}return"<Buffer "+e+">"};E.prototype.compare=function t(e,i,r,s,n){if(!I(e)){throw new TypeError("Argument must be a Buffer")}if(i===undefined){i=0}if(r===undefined){r=e?e.length:0}if(s===undefined){s=0}if(n===undefined){n=this.length}if(i<0||r>e.length||s<0||n>this.length){throw new RangeError("out of range index")}if(s>=n&&i>=r){return 0}if(s>=n){return-1}if(i>=r){return 1}i>>>=0;r>>>=0;s>>>=0;n>>>=0;if(this===e)return 0;var f=n-s;var o=r-i;var h=Math.min(f,o);var a=this.slice(s,n);var u=e.slice(i,r);for(var c=0;c<h;++c){if(a[c]!==u[c]){f=a[c];o=u[c];break}}if(f<o)return-1;if(o<f)return 1;return 0};function S(t,e,i,r,s){if(t.length===0)return-1;if(typeof i==="string"){r=i;i=0}else if(i>2147483647){i=2147483647}else if(i<-2147483648){i=-2147483648}i=+i;if(isNaN(i)){i=s?0:t.length-1}if(i<0)i=t.length+i;if(i>=t.length){if(s)return-1;else i=t.length-1}else if(i<0){if(s)i=0;else return-1}if(typeof e==="string"){e=E.from(e,r)}if(I(e)){if(e.length===0){return-1}return O(t,e,i,r,s)}else if(typeof e==="number"){e=e&255;if(E.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(s){return Uint8Array.prototype.indexOf.call(t,e,i)}else{return Uint8Array.prototype.lastIndexOf.call(t,e,i)}}return O(t,[e],i,r,s)}throw new TypeError("val must be string, number or Buffer")}function O(t,e,i,r,s){var n=1;var f=t.length;var o=e.length;if(r!==undefined){r=String(r).toLowerCase();if(r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le"){if(t.length<2||e.length<2){return-1}n=2;f/=2;o/=2;i/=2}}function h(t,e){if(n===1){return t[e]}else{return t.readUInt16BE(e*n)}}var a;if(s){var u=-1;for(a=i;a<f;a++){if(h(t,a)===h(e,u===-1?0:a-u)){if(u===-1)u=a;if(a-u+1===o)return u*n}else{if(u!==-1)a-=a-u;u=-1}}}else{if(i+o>f)i=f-o;for(a=i;a>=0;a--){var c=true;for(var l=0;l<o;l++){if(h(t,a+l)!==h(e,l)){c=false;break}}if(c)return a}}return-1}E.prototype.includes=function t(e,i,r){return this.indexOf(e,i,r)!==-1};E.prototype.indexOf=function t(e,i,r){return S(this,e,i,r,true)};E.prototype.lastIndexOf=function t(e,i,r){return S(this,e,i,r,false)};function C(t,e,i,r){i=Number(i)||0;var s=t.length-i;if(!r){r=s}else{r=Number(r);if(r>s){r=s}}var n=e.length;if(n%2!==0)throw new TypeError("Invalid hex string");if(r>n/2){r=n/2}for(var f=0;f<r;++f){var o=parseInt(e.substr(f*2,2),16);if(isNaN(o))return f;t[i+f]=o}return f}function F(t,e,i,r){return bt(at(e,t.length-i),t,i,r)}function D(t,e,i,r){return bt(ut(e),t,i,r)}function P(t,e,i,r){return D(t,e,i,r)}function q(t,e,i,r){return bt(lt(e),t,i,r)}function z(t,e,i,r){return bt(ct(e,t.length-i),t,i,r)}E.prototype.write=function t(e,i,r,s){if(i===undefined){s="utf8";r=this.length;i=0}else if(r===undefined&&typeof i==="string"){s=i;r=this.length;i=0}else if(isFinite(i)){i=i|0;if(isFinite(r)){r=r|0;if(s===undefined)s="utf8"}else{s=r;r=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var n=this.length-i;if(r===undefined||r>n)r=n;if(e.length>0&&(r<0||i<0)||i>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!s)s="utf8";var f=false;for(;;){switch(s){case"hex":return C(this,e,i,r);case"utf8":case"utf-8":return F(this,e,i,r);case"ascii":return D(this,e,i,r);case"latin1":case"binary":return P(this,e,i,r);case"base64":return q(this,e,i,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,e,i,r);default:if(f)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase();f=true}}};E.prototype.toJSON=function t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(t,e,i){if(e===0&&i===t.length){return $(t)}else{return $(t.slice(e,i))}}function L(t,e,i){i=Math.min(t.length,i);var r=[];var s=e;while(s<i){var n=t[s];var f=null;var o=n>239?4:n>223?3:n>191?2:1;if(s+o<=i){var h,a,u,c;switch(o){case 1:if(n<128){f=n}break;case 2:h=t[s+1];if((h&192)===128){c=(n&31)<<6|h&63;if(c>127){f=c}}break;case 3:h=t[s+1];a=t[s+2];if((h&192)===128&&(a&192)===128){c=(n&15)<<12|(h&63)<<6|a&63;if(c>2047&&(c<55296||c>57343)){f=c}}break;case 4:h=t[s+1];a=t[s+2];u=t[s+3];if((h&192)===128&&(a&192)===128&&(u&192)===128){c=(n&15)<<18|(h&63)<<12|(a&63)<<6|u&63;if(c>65535&&c<1114112){f=c}}}}if(f===null){f=65533;o=1}else if(f>65535){f-=65536;r.push(f>>>10&1023|55296);f=56320|f&1023}r.push(f);s+=o}return W(r)}var G=4096;function W(t){var e=t.length;if(e<=G){return String.fromCharCode.apply(String,t)}var i="";var r=0;while(r<e){i+=String.fromCharCode.apply(String,t.slice(r,r+=G))}return i}function H(t,e,i){var r="";i=Math.min(t.length,i);for(var s=e;s<i;++s){r+=String.fromCharCode(t[s]&127)}return r}function Z(t,e,i){var r="";i=Math.min(t.length,i);for(var s=e;s<i;++s){r+=String.fromCharCode(t[s])}return r}function K(t,e,i){var r=t.length;if(!e||e<0)e=0;if(!i||i<0||i>r)i=r;var s="";for(var n=e;n<i;++n){s+=ht(t[n])}return s}function Q(t,e,i){var r=t.slice(e,i);var s="";for(var n=0;n<r.length;n+=2){s+=String.fromCharCode(r[n]+r[n+1]*256)}return s}E.prototype.slice=function t(e,i){var r=this.length;e=~~e;i=i===undefined?r:~~i;if(e<0){e+=r;if(e<0)e=0}else if(e>r){e=r}if(i<0){i+=r;if(i<0)i=0}else if(i>r){i=r}if(i<e)i=e;var s;if(E.TYPED_ARRAY_SUPPORT){s=this.subarray(e,i);s.__proto__=E.prototype}else{var n=i-e;s=new E(n,undefined);for(var f=0;f<n;++f){s[f]=this[f+e]}}return s};function X(t,e,i){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}E.prototype.readUIntLE=function t(e,i,r){e=e|0;i=i|0;if(!r)X(e,i,this.length);var s=this[e];var n=1;var f=0;while(++f<i&&(n*=256)){s+=this[e+f]*n}return s};E.prototype.readUIntBE=function t(e,i,r){e=e|0;i=i|0;if(!r){X(e,i,this.length)}var s=this[e+--i];var n=1;while(i>0&&(n*=256)){s+=this[e+--i]*n}return s};E.prototype.readUInt8=function t(e,i){if(!i)X(e,1,this.length);return this[e]};E.prototype.readUInt16LE=function t(e,i){if(!i)X(e,2,this.length);return this[e]|this[e+1]<<8};E.prototype.readUInt16BE=function t(e,i){if(!i)X(e,2,this.length);return this[e]<<8|this[e+1]};E.prototype.readUInt32LE=function t(e,i){if(!i)X(e,4,this.length);return(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};E.prototype.readUInt32BE=function t(e,i){if(!i)X(e,4,this.length);return this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};E.prototype.readIntLE=function t(e,i,r){e=e|0;i=i|0;if(!r)X(e,i,this.length);var s=this[e];var n=1;var f=0;while(++f<i&&(n*=256)){s+=this[e+f]*n}n*=128;if(s>=n)s-=Math.pow(2,8*i);return s};E.prototype.readIntBE=function t(e,i,r){e=e|0;i=i|0;if(!r)X(e,i,this.length);var s=i;var n=1;var f=this[e+--s];while(s>0&&(n*=256)){f+=this[e+--s]*n}n*=128;if(f>=n)f-=Math.pow(2,8*i);return f};E.prototype.readInt8=function t(e,i){if(!i)X(e,1,this.length);if(!(this[e]&128))return this[e];return(255-this[e]+1)*-1};E.prototype.readInt16LE=function t(e,i){if(!i)X(e,2,this.length);var r=this[e]|this[e+1]<<8;return r&32768?r|4294901760:r};E.prototype.readInt16BE=function t(e,i){if(!i)X(e,2,this.length);var r=this[e+1]|this[e]<<8;return r&32768?r|4294901760:r};E.prototype.readInt32LE=function t(e,i){if(!i)X(e,4,this.length);return this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};E.prototype.readInt32BE=function t(e,i){if(!i)X(e,4,this.length);return this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};E.prototype.readFloatLE=function t(e,i){if(!i)X(e,4,this.length);return d(this,e,true,23,4)};E.prototype.readFloatBE=function t(e,i){if(!i)X(e,4,this.length);return d(this,e,false,23,4)};E.prototype.readDoubleLE=function t(e,i){if(!i)X(e,8,this.length);return d(this,e,true,52,8)};E.prototype.readDoubleBE=function t(e,i){if(!i)X(e,8,this.length);return d(this,e,false,52,8)};function Y(t,e,i,r,s,n){if(!I(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<n)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}E.prototype.writeUIntLE=function t(e,i,r,s){e=+e;i=i|0;r=r|0;if(!s){var n=Math.pow(2,8*r)-1;Y(this,e,i,r,n,0)}var f=1;var o=0;this[i]=e&255;while(++o<r&&(f*=256)){this[i+o]=e/f&255}return i+r};E.prototype.writeUIntBE=function t(e,i,r,s){e=+e;i=i|0;r=r|0;if(!s){var n=Math.pow(2,8*r)-1;Y(this,e,i,r,n,0)}var f=r-1;var o=1;this[i+f]=e&255;while(--f>=0&&(o*=256)){this[i+f]=e/o&255}return i+r};E.prototype.writeUInt8=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,1,255,0);if(!E.TYPED_ARRAY_SUPPORT)e=Math.floor(e);this[i]=e&255;return i+1};function tt(t,e,i,r){if(e<0)e=65535+e+1;for(var s=0,n=Math.min(t.length-i,2);s<n;++s){t[i+s]=(e&255<<8*(r?s:1-s))>>>(r?s:1-s)*8}}E.prototype.writeUInt16LE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,2,65535,0);if(E.TYPED_ARRAY_SUPPORT){this[i]=e&255;this[i+1]=e>>>8}else{tt(this,e,i,true)}return i+2};E.prototype.writeUInt16BE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,2,65535,0);if(E.TYPED_ARRAY_SUPPORT){this[i]=e>>>8;this[i+1]=e&255}else{tt(this,e,i,false)}return i+2};function et(t,e,i,r){if(e<0)e=4294967295+e+1;for(var s=0,n=Math.min(t.length-i,4);s<n;++s){t[i+s]=e>>>(r?s:3-s)*8&255}}E.prototype.writeUInt32LE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,4,4294967295,0);if(E.TYPED_ARRAY_SUPPORT){this[i+3]=e>>>24;this[i+2]=e>>>16;this[i+1]=e>>>8;this[i]=e&255}else{et(this,e,i,true)}return i+4};E.prototype.writeUInt32BE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,4,4294967295,0);if(E.TYPED_ARRAY_SUPPORT){this[i]=e>>>24;this[i+1]=e>>>16;this[i+2]=e>>>8;this[i+3]=e&255}else{et(this,e,i,false)}return i+4};E.prototype.writeIntLE=function t(e,i,r,s){e=+e;i=i|0;if(!s){var n=Math.pow(2,8*r-1);Y(this,e,i,r,n-1,-n)}var f=0;var o=1;var h=0;this[i]=e&255;while(++f<r&&(o*=256)){if(e<0&&h===0&&this[i+f-1]!==0){h=1}this[i+f]=(e/o>>0)-h&255}return i+r};E.prototype.writeIntBE=function t(e,i,r,s){e=+e;i=i|0;if(!s){var n=Math.pow(2,8*r-1);Y(this,e,i,r,n-1,-n)}var f=r-1;var o=1;var h=0;this[i+f]=e&255;while(--f>=0&&(o*=256)){if(e<0&&h===0&&this[i+f+1]!==0){h=1}this[i+f]=(e/o>>0)-h&255}return i+r};E.prototype.writeInt8=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,1,127,-128);if(!E.TYPED_ARRAY_SUPPORT)e=Math.floor(e);if(e<0)e=255+e+1;this[i]=e&255;return i+1};E.prototype.writeInt16LE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,2,32767,-32768);if(E.TYPED_ARRAY_SUPPORT){this[i]=e&255;this[i+1]=e>>>8}else{tt(this,e,i,true)}return i+2};E.prototype.writeInt16BE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,2,32767,-32768);if(E.TYPED_ARRAY_SUPPORT){this[i]=e>>>8;this[i+1]=e&255}else{tt(this,e,i,false)}return i+2};E.prototype.writeInt32LE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,4,2147483647,-2147483648);if(E.TYPED_ARRAY_SUPPORT){this[i]=e&255;this[i+1]=e>>>8;this[i+2]=e>>>16;this[i+3]=e>>>24}else{et(this,e,i,true)}return i+4};E.prototype.writeInt32BE=function t(e,i,r){e=+e;i=i|0;if(!r)Y(this,e,i,4,2147483647,-2147483648);if(e<0)e=4294967295+e+1;if(E.TYPED_ARRAY_SUPPORT){this[i]=e>>>24;this[i+1]=e>>>16;this[i+2]=e>>>8;this[i+3]=e&255}else{et(this,e,i,false)}return i+4};function it(t,e,i,r,s,n){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function rt(t,e,i,r,s){if(!s){it(t,e,i,4)}w(t,e,i,r,23,4);return i+4}E.prototype.writeFloatLE=function t(e,i,r){return rt(this,e,i,true,r)};E.prototype.writeFloatBE=function t(e,i,r){return rt(this,e,i,false,r)};function st(t,e,i,r,s){if(!s){it(t,e,i,8)}w(t,e,i,r,52,8);return i+8}E.prototype.writeDoubleLE=function t(e,i,r){return st(this,e,i,true,r)};E.prototype.writeDoubleBE=function t(e,i,r){return st(this,e,i,false,r)};E.prototype.copy=function t(e,i,r,s){if(!r)r=0;if(!s&&s!==0)s=this.length;if(i>=e.length)i=e.length;if(!i)i=0;if(s>0&&s<r)s=r;if(s===r)return 0;if(e.length===0||this.length===0)return 0;if(i<0){throw new RangeError("targetStart out of bounds")}if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(s<0)throw new RangeError("sourceEnd out of bounds");if(s>this.length)s=this.length;if(e.length-i<s-r){s=e.length-i+r}var n=s-r;var f;if(this===e&&r<i&&i<s){for(f=n-1;f>=0;--f){e[f+i]=this[f+r]}}else if(n<1e3||!E.TYPED_ARRAY_SUPPORT){for(f=0;f<n;++f){e[f+i]=this[f+r]}}else{Uint8Array.prototype.set.call(e,this.subarray(r,r+n),i)}return n};E.prototype.fill=function t(e,i,r,s){if(typeof e==="string"){if(typeof i==="string"){s=i;i=0;r=this.length}else if(typeof r==="string"){s=r;r=this.length}if(e.length===1){var n=e.charCodeAt(0);if(n<256){e=n}}if(s!==undefined&&typeof s!=="string"){throw new TypeError("encoding must be a string")}if(typeof s==="string"&&!E.isEncoding(s)){throw new TypeError("Unknown encoding: "+s)}}else if(typeof e==="number"){e=e&255}if(i<0||this.length<i||this.length<r){throw new RangeError("Out of range index")}if(r<=i){return this}i=i>>>0;r=r===undefined?this.length:r>>>0;if(!e)e=0;var f;if(typeof e==="number"){for(f=i;f<r;++f){this[f]=e}}else{var o=I(e)?e:at(new E(e,s).toString());var h=o.length;for(f=0;f<r-i;++f){this[f+i]=o[f%h]}}return this};var nt=/[^+\/0-9A-Za-z-_]/g;function ft(t){t=ot(t).replace(nt,"");if(t.length<2)return"";while(t.length%4!==0){t=t+"="}return t}function ot(t){if(t.trim)return t.trim();return t.replace(/^\s+|\s+$/g,"")}function ht(t){if(t<16)return"0"+t.toString(16);return t.toString(16)}function at(t,e){e=e||Infinity;var i;var r=t.length;var s=null;var n=[];for(var f=0;f<r;++f){i=t.charCodeAt(f);if(i>55295&&i<57344){if(!s){if(i>56319){if((e-=3)>-1)n.push(239,191,189);continue}else if(f+1===r){if((e-=3)>-1)n.push(239,191,189);continue}s=i;continue}if(i<56320){if((e-=3)>-1)n.push(239,191,189);s=i;continue}i=(s-55296<<10|i-56320)+65536}else if(s){if((e-=3)>-1)n.push(239,191,189)}s=null;if(i<128){if((e-=1)<0)break;n.push(i)}else if(i<2048){if((e-=2)<0)break;n.push(i>>6|192,i&63|128)}else if(i<65536){if((e-=3)<0)break;n.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((e-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else{throw new Error("Invalid code point")}}return n}function ut(t){var e=[];for(var i=0;i<t.length;++i){e.push(t.charCodeAt(i)&255)}return e}function ct(t,e){var i,r,s;var n=[];for(var f=0;f<t.length;++f){if((e-=2)<0)break;i=t.charCodeAt(f);r=i>>8;s=i%256;n.push(s);n.push(r)}return n}function lt(t){return c(ft(t))}function bt(t,e,i,r){for(var s=0;s<r;++s){if(s+i>=e.length||s>=t.length)break;e[s+i]=t[s]}return s}function $t(t){return t!==t}function dt(t){return t!=null&&(!!t._isBuffer||wt(t)||vt(t))}function wt(t){return!!t.constructor&&typeof t.constructor.isBuffer==="function"&&t.constructor.isBuffer(t)}function vt(t){return typeof t.readFloatLE==="function"&&typeof t.slice==="function"&&wt(t.slice(0,0))}class gt{constructor(t,e){this.code="";this.scopes=[["vars"]];this.bitFields=[];this.tmpVariableCount=0;this.references=new Map;this.imports=[];this.reverseImports=new Map;this.useContextVariables=false;this.importPath=t;this.useContextVariables=e}generateVariable(t){const e=[...this.scopes[this.scopes.length-1]];if(t){e.push(t)}return e.join(".")}generateOption(t){switch(typeof t){case"number":return t.toString();case"string":return this.generateVariable(t);case"function":return`${this.addImport(t)}.call(${this.generateVariable()}, vars)`}}generateError(t){this.pushCode(`throw new Error(${t});`)}generateTmpVariable(){return"$tmp"+this.tmpVariableCount++}pushCode(t){this.code+=t+"\n"}pushPath(t){if(t){this.scopes[this.scopes.length-1].push(t)}}popPath(t){if(t){this.scopes[this.scopes.length-1].pop()}}pushScope(t){this.scopes.push([t])}popScope(){this.scopes.pop()}addImport(t){if(!this.importPath)return`(${t})`;let e=this.reverseImports.get(t);if(!e){e=this.imports.push(t)-1;this.reverseImports.set(t,e)}return`${this.importPath}[${e}]`}addReference(t){if(!this.references.has(t)){this.references.set(t,{resolved:false,requested:false})}}markResolved(t){const e=this.references.get(t);if(e){e.resolved=true}}markRequested(t){t.forEach((t=>{const e=this.references.get(t);if(e){e.requested=true}}))}getUnresolvedReferences(){return Array.from(this.references).filter((([t,e])=>!e.resolved&&!e.requested)).map((([t,e])=>t))}}const pt=new Map;const yt="___parser_";const mt={uint8:1,uint16le:2,uint16be:2,uint32le:4,uint32be:4,int8:1,int16le:2,int16be:2,int32le:4,int32be:4,int64be:8,int64le:8,uint64be:8,uint64le:8,floatle:4,floatbe:4,doublele:8,doublebe:8};const Et={uint8:"Uint8",uint16le:"Uint16",uint16be:"Uint16",uint32le:"Uint32",uint32be:"Uint32",int8:"Int8",int16le:"Int16",int16be:"Int16",int32le:"Int32",int32be:"Int32",int64be:"BigInt64",int64le:"BigInt64",uint64be:"BigUint64",uint64le:"BigUint64",floatle:"Float32",floatbe:"Float32",doublele:"Float64",doublebe:"Float64"};const kt={uint8:false,uint16le:true,uint16be:false,uint32le:true,uint32be:false,int8:false,int16le:true,int16be:false,int32le:true,int32be:false,int64be:false,int64le:true,uint64be:false,uint64le:true,floatle:true,floatbe:false,doublele:true,doublebe:false};class xt{constructor(){this.varName="";this.type="";this.options={};this.endian="be";this.useContextVariables=false}static start(){return new xt}primitiveGenerateN(t,e){const i=Et[t];const r=kt[t];e.pushCode(`${e.generateVariable(this.varName)} = dataView.get${i}(offset, ${r});`);e.pushCode(`offset += ${mt[t]};`)}primitiveN(t,e,i){return this.setNextParser(t,e,i)}useThisEndian(t){return t+this.endian.toLowerCase()}uint8(t,e={}){return this.primitiveN("uint8",t,e)}uint16(t,e={}){return this.primitiveN(this.useThisEndian("uint16"),t,e)}uint16le(t,e={}){return this.primitiveN("uint16le",t,e)}uint16be(t,e={}){return this.primitiveN("uint16be",t,e)}uint32(t,e={}){return this.primitiveN(this.useThisEndian("uint32"),t,e)}uint32le(t,e={}){return this.primitiveN("uint32le",t,e)}uint32be(t,e={}){return this.primitiveN("uint32be",t,e)}int8(t,e={}){return this.primitiveN("int8",t,e)}int16(t,e={}){return this.primitiveN(this.useThisEndian("int16"),t,e)}int16le(t,e={}){return this.primitiveN("int16le",t,e)}int16be(t,e={}){return this.primitiveN("int16be",t,e)}int32(t,e={}){return this.primitiveN(this.useThisEndian("int32"),t,e)}int32le(t,e={}){return this.primitiveN("int32le",t,e)}int32be(t,e={}){return this.primitiveN("int32be",t,e)}bigIntVersionCheck(){if(!DataView.prototype.getBigInt64)throw new Error("BigInt64 is unsupported on this runtime")}int64(t,e={}){this.bigIntVersionCheck();return this.primitiveN(this.useThisEndian("int64"),t,e)}int64be(t,e={}){this.bigIntVersionCheck();return this.primitiveN("int64be",t,e)}int64le(t,e={}){this.bigIntVersionCheck();return this.primitiveN("int64le",t,e)}uint64(t,e={}){this.bigIntVersionCheck();return this.primitiveN(this.useThisEndian("uint64"),t,e)}uint64be(t,e={}){this.bigIntVersionCheck();return this.primitiveN("uint64be",t,e)}uint64le(t,e={}){this.bigIntVersionCheck();return this.primitiveN("uint64le",t,e)}floatle(t,e={}){return this.primitiveN("floatle",t,e)}floatbe(t,e={}){return this.primitiveN("floatbe",t,e)}doublele(t,e={}){return this.primitiveN("doublele",t,e)}doublebe(t,e={}){return this.primitiveN("doublebe",t,e)}bitN(t,e,i){i.length=t;return this.setNextParser("bit",e,i)}bit1(t,e={}){return this.bitN(1,t,e)}bit2(t,e={}){return this.bitN(2,t,e)}bit3(t,e={}){return this.bitN(3,t,e)}bit4(t,e={}){return this.bitN(4,t,e)}bit5(t,e={}){return this.bitN(5,t,e)}bit6(t,e={}){return this.bitN(6,t,e)}bit7(t,e={}){return this.bitN(7,t,e)}bit8(t,e={}){return this.bitN(8,t,e)}bit9(t,e={}){return this.bitN(9,t,e)}bit10(t,e={}){return this.bitN(10,t,e)}bit11(t,e={}){return this.bitN(11,t,e)}bit12(t,e={}){return this.bitN(12,t,e)}bit13(t,e={}){return this.bitN(13,t,e)}bit14(t,e={}){return this.bitN(14,t,e)}bit15(t,e={}){return this.bitN(15,t,e)}bit16(t,e={}){return this.bitN(16,t,e)}bit17(t,e={}){return this.bitN(17,t,e)}bit18(t,e={}){return this.bitN(18,t,e)}bit19(t,e={}){return this.bitN(19,t,e)}bit20(t,e={}){return this.bitN(20,t,e)}bit21(t,e={}){return this.bitN(21,t,e)}bit22(t,e={}){return this.bitN(22,t,e)}bit23(t,e={}){return this.bitN(23,t,e)}bit24(t,e={}){return this.bitN(24,t,e)}bit25(t,e={}){return this.bitN(25,t,e)}bit26(t,e={}){return this.bitN(26,t,e)}bit27(t,e={}){return this.bitN(27,t,e)}bit28(t,e={}){return this.bitN(28,t,e)}bit29(t,e={}){return this.bitN(29,t,e)}bit30(t,e={}){return this.bitN(30,t,e)}bit31(t,e={}){return this.bitN(31,t,e)}bit32(t,e={}){return this.bitN(32,t,e)}namely(t){pt.set(t,this);this.alias=t;return this}skip(t,e={}){return this.seek(t,e)}seek(t,e={}){if(e.assert){throw new Error("assert option on seek is not allowed.")}return this.setNextParser("seek","",{length:t})}string(t,e){if(!e.zeroTerminated&&!e.length&&!e.greedy){throw new Error("One of length, zeroTerminated, or greedy must be defined for string.")}if((e.zeroTerminated||e.length)&&e.greedy){throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.")}if(e.stripNull&&!(e.length||e.greedy)){throw new Error("length or greedy must be defined if stripNull is enabled.")}e.encoding=e.encoding||"utf8";return this.setNextParser("string",t,e)}buffer(t,e){if(!e.length&&!e.readUntil){throw new Error("length or readUntil must be defined for buffer.")}return this.setNextParser("buffer",t,e)}wrapped(t,e){if(typeof e!=="object"&&typeof t==="object"){e=t;t=""}if(!e||!e.wrapper||!e.type){throw new Error("Both wrapper and type must be defined for wrapped.")}if(!e.length&&!e.readUntil){throw new Error("length or readUntil must be defined for wrapped.")}return this.setNextParser("wrapper",t,e)}array(t,e){if(!e.readUntil&&!e.length&&!e.lengthInBytes){throw new Error("One of readUntil, length and lengthInBytes must be defined for array.")}if(!e.type){throw new Error("type is required for array.")}if(typeof e.type==="string"&&!pt.has(e.type)&&!(e.type in mt)){throw new Error(`Array element type "${e.type}" is unkown.`)}return this.setNextParser("array",t,e)}choice(t,e){if(typeof e!=="object"&&typeof t==="object"){e=t;t=""}if(!e){throw new Error("tag and choices are are required for choice.")}if(!e.tag){throw new Error("tag is requird for choice.")}if(!e.choices){throw new Error("choices is required for choice.")}for(const t in e.choices){const i=parseInt(t,10);const r=e.choices[i];if(isNaN(i)){throw new Error(`Choice key "${t}" is not a number.`)}if(typeof r==="string"&&!pt.has(r)&&!(r in mt)){throw new Error(`Choice type "${r}" is unkown.`)}}return this.setNextParser("choice",t,e)}nest(t,e){if(typeof e!=="object"&&typeof t==="object"){e=t;t=""}if(!e||!e.type){throw new Error("type is required for nest.")}if(!(e.type instanceof xt)&&!pt.has(e.type)){throw new Error("type must be a known parser name or a Parser object.")}if(!(e.type instanceof xt)&&!t){throw new Error("type must be a Parser object if the variable name is omitted.")}return this.setNextParser("nest",t,e)}pointer(t,e){if(!e.offset){throw new Error("offset is required for pointer.")}if(!e.type){throw new Error("type is required for pointer.")}if(typeof e.type==="string"&&!(e.type in mt)&&!pt.has(e.type)){throw new Error(`Pointer type "${e.type}" is unkown.`)}return this.setNextParser("pointer",t,e)}saveOffset(t,e={}){return this.setNextParser("saveOffset",t,e)}endianness(t){switch(t.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error('endianness must be one of "little" or "big"')}return this}endianess(t){return this.endianness(t)}useContextVars(t=true){this.useContextVariables=t;return this}create(t){if(!(t instanceof Function)){throw new Error("Constructor must be a Function object.")}this.constructorFn=t;return this}getContext(t){const e=new gt(t,this.useContextVariables);e.pushCode("var dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);");if(!this.alias){this.addRawCode(e)}else{this.addAliasedCode(e);e.pushCode(`return ${yt+this.alias}(0).result;`)}return e}getCode(){const t="imports";return this.getContext(t).code}addRawCode(t){t.pushCode("var offset = 0;");t.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`);t.pushCode("vars.$parent = null;");t.pushCode("vars.$root = vars;");this.generate(t);this.resolveReferences(t);t.pushCode("delete vars.$parent;");t.pushCode("delete vars.$root;");t.pushCode("return vars;")}addAliasedCode(t){t.pushCode(`function ${yt+this.alias}(offset, context) {`);t.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`);t.pushCode("var ctx = Object.assign({$parent: null, $root: vars}, context || {});");t.pushCode(`vars = Object.assign(vars, ctx);`);this.generate(t);t.markResolved(this.alias);this.resolveReferences(t);t.pushCode("Object.keys(ctx).forEach(function (item) { delete vars[item]; });");t.pushCode("return { offset: offset, result: vars };");t.pushCode("}");return t}resolveReferences(t){const e=t.getUnresolvedReferences();t.markRequested(e);e.forEach((e=>{var i;(i=pt.get(e))===null||i===void 0?void 0:i.addAliasedCode(t)}))}compile(){const t="imports";const e=this.getContext(t);this.compiled=new Function(t,"TextDecoder",`return function (buffer, constructorFn) { ${e.code} };`)(e.imports,TextDecoder)}sizeOf(){let t=NaN;if(Object.keys(mt).indexOf(this.type)>=0){t=mt[this.type]}else if(this.type==="string"&&typeof this.options.length==="number"){t=this.options.length}else if(this.type==="buffer"&&typeof this.options.length==="number"){t=this.options.length}else if(this.type==="array"&&typeof this.options.length==="number"){let e=NaN;if(typeof this.options.type==="string"){e=mt[this.options.type]}else if(this.options.type instanceof xt){e=this.options.type.sizeOf()}t=this.options.length*e}else if(this.type==="seek"){t=this.options.length}else if(this.type==="nest"){t=this.options.type.sizeOf()}else if(!this.type){t=0}if(this.next){t+=this.next.sizeOf()}return t}parse(t){if(!this.compiled){this.compile()}return this.compiled(t,this.constructorFn)}setNextParser(t,e,i){const r=new xt;r.type=t;r.varName=e;r.options=i;r.endian=this.endian;if(this.head){this.head.next=r}else{this.next=r}this.head=r;return this}generate(t){if(this.type){switch(this.type){case"uint8":case"uint16le":case"uint16be":case"uint32le":case"uint32be":case"int8":case"int16le":case"int16be":case"int32le":case"int32be":case"int64be":case"int64le":case"uint64be":case"uint64le":case"floatle":case"floatbe":case"doublele":case"doublebe":this.primitiveGenerateN(this.type,t);break;case"bit":this.generateBit(t);break;case"string":this.generateString(t);break;case"buffer":this.generateBuffer(t);break;case"seek":this.generateSeek(t);break;case"nest":this.generateNest(t);break;case"array":this.generateArray(t);break;case"choice":this.generateChoice(t);break;case"pointer":this.generatePointer(t);break;case"saveOffset":this.generateSaveOffset(t);break;case"wrapper":this.generateWrapper(t);break}if(this.type!=="bit")this.generateAssert(t)}const e=t.generateVariable(this.varName);if(this.options.formatter&&this.type!=="bit"){this.generateFormatter(t,e,this.options.formatter)}return this.generateNext(t)}generateAssert(t){if(!this.options.assert){return}const e=t.generateVariable(this.varName);switch(typeof this.options.assert){case"function":{const i=t.addImport(this.options.assert);t.pushCode(`if (!${i}.call(vars, ${e})) {`)}break;case"number":t.pushCode(`if (${this.options.assert} !== ${e}) {`);break;case"string":t.pushCode(`if (${JSON.stringify(this.options.assert)} !== ${e}) {`);break;default:throw new Error("assert option must be a string, number or a function.")}t.generateError(`"Assertion error: ${e} is " + ${JSON.stringify(this.options.assert.toString())}`);t.pushCode("}")}generateNext(t){if(this.next){t=this.next.generate(t)}return t}generateBit(t){const e=JSON.parse(JSON.stringify(this));e.options=this.options;e.generateAssert=this.generateAssert.bind(this);e.generateFormatter=this.generateFormatter.bind(this);e.varName=t.generateVariable(e.varName);t.bitFields.push(e);if(!this.next||this.next&&["bit","nest"].indexOf(this.next.type)<0){const e=t.generateTmpVariable();t.pushCode(`var ${e} = 0;`);const i=(e=0)=>{let i=0;for(let r=e;r<t.bitFields.length;r++){const e=t.bitFields[r].options.length;if(i+e>32)break;i+=e}return i};const r=i=>{if(i<=8){t.pushCode(`${e} = dataView.getUint8(offset);`);i=8}else if(i<=16){t.pushCode(`${e} = dataView.getUint16(offset);`);i=16}else if(i<=24){t.pushCode(`${e} = (dataView.getUint16(offset) << 8) | dataView.getUint8(offset + 2);`);i=24}else{t.pushCode(`${e} = dataView.getUint32(offset);`);i=32}t.pushCode(`offset += ${i/8};`);return i};let s=0;const n=this.endian==="be";let f=0;let o=0;t.bitFields.forEach(((h,a)=>{let u=h.options.length;if(u>o){if(o){const i=-1>>>32-o;t.pushCode(`${h.varName} = (${e} & 0x${i.toString(16)}) << ${u-o};`);u-=o}s=0;o=f=r(i(a)-o)}const c=n?f-s-u:s;const l=-1>>>32-u;t.pushCode(`${h.varName} ${u<h.options.length?"|=":"="} ${e} >> ${c} & 0x${l.toString(16)};`);if(h.options.length===32){t.pushCode(`${h.varName} >>>= 0`)}if(h.options.assert){h.generateAssert(t)}if(h.options.formatter){h.generateFormatter(t,h.varName,h.options.formatter)}s+=u;o-=u}));t.bitFields=[]}}generateSeek(t){const e=t.generateOption(this.options.length);t.pushCode(`offset += ${e};`)}generateString(t){const e=t.generateVariable(this.varName);const i=t.generateTmpVariable();const r=this.options.encoding;const s=r.toLowerCase()==="hex";const n='b => b.toString(16).padStart(2, "0")';if(this.options.length&&this.options.zeroTerminated){const f=this.options.length;t.pushCode(`var ${i} = offset;`);t.pushCode(`while(dataView.getUint8(offset++) !== 0 && offset - ${i} < ${f});`);const o=`offset - ${i} < ${f} ? offset - 1 : offset`;t.pushCode(s?`${e} = Array.from(buffer.subarray(${i}, ${o}), ${n}).join('');`:`${e} = new TextDecoder('${r}').decode(buffer.subarray(${i}, ${o}));`)}else if(this.options.length){const i=t.generateOption(this.options.length);t.pushCode(s?`${e} = Array.from(buffer.subarray(offset, offset + ${i}), ${n}).join('');`:`${e} = new TextDecoder('${r}').decode(buffer.subarray(offset, offset + ${i}));`);t.pushCode(`offset += ${i};`)}else if(this.options.zeroTerminated){t.pushCode(`var ${i} = offset;`);t.pushCode("while(dataView.getUint8(offset++) !== 0);");t.pushCode(s?`${e} = Array.from(buffer.subarray(${i}, offset - 1), ${n}).join('');`:`${e} = new TextDecoder('${r}').decode(buffer.subarray(${i}, offset - 1));`)}else if(this.options.greedy){t.pushCode(`var ${i} = offset;`);t.pushCode("while(buffer.length > offset++);");t.pushCode(s?`${e} = Array.from(buffer.subarray(${i}, offset), ${n}).join('');`:`${e} = new TextDecoder('${r}').decode(buffer.subarray(${i}, offset));`)}if(this.options.stripNull){t.pushCode(`${e} = ${e}.replace(/\\x00+$/g, '')`)}}generateBuffer(t){const e=t.generateVariable(this.varName);if(typeof this.options.readUntil==="function"){const i=this.options.readUntil;const r=t.generateTmpVariable();const s=t.generateTmpVariable();t.pushCode(`var ${r} = offset;`);t.pushCode(`var ${s} = 0;`);t.pushCode(`while (offset < buffer.length) {`);t.pushCode(`${s} = dataView.getUint8(offset);`);const n=t.addImport(i);t.pushCode(`if (${n}.call(${t.generateVariable()}, ${s}, buffer.subarray(offset))) break;`);t.pushCode(`offset += 1;`);t.pushCode(`}`);t.pushCode(`${e} = buffer.subarray(${r}, offset);`)}else if(this.options.readUntil==="eof"){t.pushCode(`${e} = buffer.subarray(offset);`)}else{const i=t.generateOption(this.options.length);t.pushCode(`${e} = buffer.subarray(offset, offset + ${i});`);t.pushCode(`offset += ${i};`)}if(this.options.clone){t.pushCode(`${e} = buffer.constructor.from(${e});`)}}generateArray(t){const e=t.generateOption(this.options.length);const i=t.generateOption(this.options.lengthInBytes);const r=this.options.type;const s=t.generateTmpVariable();const n=t.generateVariable(this.varName);const f=t.generateTmpVariable();const o=this.options.key;const h=typeof o==="string";if(h){t.pushCode(`${n} = {};`)}else{t.pushCode(`${n} = [];`)}if(typeof this.options.readUntil==="function"){t.pushCode("do {")}else if(this.options.readUntil==="eof"){t.pushCode(`for (var ${s} = 0; offset < buffer.length; ${s}++) {`)}else if(i!==undefined){t.pushCode(`for (var ${s} = offset + ${i}; offset < ${s}; ) {`)}else{t.pushCode(`for (var ${s} = ${e}; ${s} > 0; ${s}--) {`)}if(typeof r==="string"){if(!pt.get(r)){const e=Et[r];const i=kt[r];t.pushCode(`var ${f} = dataView.get${e}(offset, ${i});`);t.pushCode(`offset += ${mt[r]};`)}else{const n=t.generateTmpVariable();t.pushCode(`var ${n} = ${yt+r}(offset, {`);if(t.useContextVariables){const r=t.generateVariable();t.pushCode(`$parent: ${r},`);t.pushCode(`$root: ${r}.$root,`);if(!this.options.readUntil&&i===undefined){t.pushCode(`$index: ${e} - ${s},`)}}t.pushCode(`});`);t.pushCode(`var ${f} = ${n}.result; offset = ${n}.offset;`);if(r!==this.alias)t.addReference(r)}}else if(r instanceof xt){t.pushCode(`var ${f} = {};`);const n=t.generateVariable();t.pushScope(f);if(t.useContextVariables){t.pushCode(`${f}.$parent = ${n};`);t.pushCode(`${f}.$root = ${n}.$root;`);if(!this.options.readUntil&&i===undefined){t.pushCode(`${f}.$index = ${e} - ${s};`)}}r.generate(t);if(t.useContextVariables){t.pushCode(`delete ${f}.$parent;`);t.pushCode(`delete ${f}.$root;`);t.pushCode(`delete ${f}.$index;`)}t.popScope()}if(h){t.pushCode(`${n}[${f}.${o}] = ${f};`)}else{t.pushCode(`${n}.push(${f});`)}t.pushCode("}");if(typeof this.options.readUntil==="function"){const e=this.options.readUntil;const i=t.addImport(e);t.pushCode(`while (!${i}.call(${t.generateVariable()}, ${f}, buffer.subarray(offset)));`)}}generateChoiceCase(t,e,i){if(typeof i==="string"){const e=t.generateVariable(this.varName);if(!pt.has(i)){const r=Et[i];const s=kt[i];t.pushCode(`${e} = dataView.get${r}(offset, ${s});`);t.pushCode(`offset += ${mt[i]}`)}else{const r=t.generateTmpVariable();t.pushCode(`var ${r} = ${yt+i}(offset, {`);if(t.useContextVariables){t.pushCode(`$parent: ${e}.$parent,`);t.pushCode(`$root: ${e}.$root,`)}t.pushCode(`});`);t.pushCode(`${e} = ${r}.result; offset = ${r}.offset;`);if(i!==this.alias)t.addReference(i)}}else if(i instanceof xt){t.pushPath(e);i.generate(t);t.popPath(e)}}generateChoice(t){const e=t.generateOption(this.options.tag);const i=t.generateVariable(this.varName);if(this.varName){t.pushCode(`${i} = {};`);if(t.useContextVariables){const e=t.generateVariable();t.pushCode(`${i}.$parent = ${e};`);t.pushCode(`${i}.$root = ${e}.$root;`)}}t.pushCode(`switch(${e}) {`);for(const e in this.options.choices){const i=parseInt(e,10);const r=this.options.choices[i];t.pushCode(`case ${i}:`);this.generateChoiceCase(t,this.varName,r);t.pushCode("break;")}t.pushCode("default:");if(this.options.defaultChoice){this.generateChoiceCase(t,this.varName,this.options.defaultChoice)}else{t.generateError(`"Met undefined tag value " + ${e} + " at choice"`)}t.pushCode("}");if(this.varName&&t.useContextVariables){t.pushCode(`delete ${i}.$parent;`);t.pushCode(`delete ${i}.$root;`)}}generateNest(t){const e=t.generateVariable(this.varName);if(this.options.type instanceof xt){if(this.varName){t.pushCode(`${e} = {};`);if(t.useContextVariables){const i=t.generateVariable();t.pushCode(`${e}.$parent = ${i};`);t.pushCode(`${e}.$root = ${i}.$root;`)}}t.pushPath(this.varName);this.options.type.generate(t);t.popPath(this.varName);if(this.varName&&t.useContextVariables){if(t.useContextVariables){t.pushCode(`delete ${e}.$parent;`);t.pushCode(`delete ${e}.$root;`)}}}else if(pt.has(this.options.type)){const i=t.generateTmpVariable();t.pushCode(`var ${i} = ${yt+this.options.type}(offset, {`);if(t.useContextVariables){const e=t.generateVariable();t.pushCode(`$parent: ${e},`);t.pushCode(`$root: ${e}.$root,`)}t.pushCode(`});`);t.pushCode(`${e} = ${i}.result; offset = ${i}.offset;`);if(this.options.type!==this.alias){t.addReference(this.options.type)}}}generateWrapper(t){const e=t.generateVariable(this.varName);const i=t.generateTmpVariable();if(typeof this.options.readUntil==="function"){const e=this.options.readUntil;const r=t.generateTmpVariable();const s=t.generateTmpVariable();t.pushCode(`var ${r} = offset;`);t.pushCode(`var ${s} = 0;`);t.pushCode(`while (offset < buffer.length) {`);t.pushCode(`${s} = dataView.getUint8(offset);`);const n=t.addImport(e);t.pushCode(`if (${n}.call(${t.generateVariable()}, ${s}, buffer.subarray(offset))) break;`);t.pushCode(`offset += 1;`);t.pushCode(`}`);t.pushCode(`${i} = buffer.subarray(${r}, offset);`)}else if(this.options.readUntil==="eof"){t.pushCode(`${i} = buffer.subarray(offset);`)}else{const e=t.generateOption(this.options.length);t.pushCode(`${i} = buffer.subarray(offset, offset + ${e});`);t.pushCode(`offset += ${e};`)}if(this.options.clone){t.pushCode(`${i} = buffer.constructor.from(${i});`)}const r=t.generateTmpVariable();const s=t.generateTmpVariable();const n=t.generateTmpVariable();const f=t.addImport(this.options.wrapper);t.pushCode(`${i} = ${f}.call(this, ${i}).subarray(0);`);t.pushCode(`var ${r} = buffer;`);t.pushCode(`var ${s} = offset;`);t.pushCode(`var ${n} = dataView;`);t.pushCode(`buffer = ${i};`);t.pushCode(`offset = 0;`);t.pushCode(`dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);`);if(this.options.type instanceof xt){if(this.varName){t.pushCode(`${e} = {};`)}t.pushPath(this.varName);this.options.type.generate(t);t.popPath(this.varName)}else if(pt.has(this.options.type)){const i=t.generateTmpVariable();t.pushCode(`var ${i} = ${yt+this.options.type}(0);`);t.pushCode(`${e} = ${i}.result;`);if(this.options.type!==this.alias){t.addReference(this.options.type)}}t.pushCode(`buffer = ${r};`);t.pushCode(`dataView = ${n};`);t.pushCode(`offset = ${s};`)}generateFormatter(t,e,i){if(typeof i==="function"){const r=t.addImport(i);t.pushCode(`${e} = ${r}.call(${t.generateVariable()}, ${e});`)}}generatePointer(t){const e=this.options.type;const i=t.generateOption(this.options.offset);const r=t.generateTmpVariable();const s=t.generateVariable(this.varName);t.pushCode(`var ${r} = offset;`);t.pushCode(`offset = ${i};`);if(this.options.type instanceof xt){t.pushCode(`${s} = {};`);if(t.useContextVariables){const e=t.generateVariable();t.pushCode(`${s}.$parent = ${e};`);t.pushCode(`${s}.$root = ${e}.$root;`)}t.pushPath(this.varName);this.options.type.generate(t);t.popPath(this.varName);if(t.useContextVariables){t.pushCode(`delete ${s}.$parent;`);t.pushCode(`delete ${s}.$root;`)}}else if(pt.has(this.options.type)){const e=t.generateTmpVariable();t.pushCode(`var ${e} = ${yt+this.options.type}(offset, {`);if(t.useContextVariables){const e=t.generateVariable();t.pushCode(`$parent: ${e},`);t.pushCode(`$root: ${e}.$root,`)}t.pushCode(`});`);t.pushCode(`${s} = ${e}.result; offset = ${e}.offset;`);if(this.options.type!==this.alias){t.addReference(this.options.type)}}else if(Object.keys(mt).indexOf(this.options.type)>=0){const i=Et[e];const r=kt[e];t.pushCode(`${s} = dataView.get${i}(offset, ${r});`);t.pushCode(`offset += ${mt[e]};`)}t.pushCode(`offset = ${r};`)}generateSaveOffset(t){const e=t.generateVariable(this.varName);t.pushCode(`${e} = offset`)}}function At(){return(new xt).endianess("little")}function Bt(){const t=At().uint16("from").uint16("to");const e=At().uint16("R").uint16("G").uint16("B");const i=At().uint16("_chars").string("text",{length:"_chars"});return At().uint16("_name").string("name",{length:"_name"}).uint16("_format").string("format",{length:"_format"}).uint16("_points").uint16("_limbs").uint16("_colors").array("points",{type:i,formatter:t=>t.map((t=>t.text)),length:"_points"}).array("limbs",{type:t,length:"_limbs"}).array("colors",{type:e,length:"_colors"})}function Mt(){const t=Bt();return At().floatle("version").uint16("width").uint16("height").uint16("depth").uint16("_components").array("components",{type:t,length:"_components"}).saveOffset("headerLength")}function Nt(t){let e=At().int16("id");t.components.forEach((t=>{let i=At();Array.from(t.format).forEach((t=>{i=i.floatle(t)}));e=e.array(t.name,{type:i,length:t._points})}));const i=At().uint16("_people").array("people",{type:e,length:"_people"});return At().seek(t.headerLength).uint16("fps").uint16("_frames").array("frames",{type:i,length:"_frames"})}function Rt(t,e){return Nt(t).parse(e)}function Ut(t,e,i){const r=t.components.map((t=>t.points.length)).reduce(((t,e)=>t+e),0);const s=Math.max(...t.components.map((t=>t.format.length)))-1;let n=At().seek(t.headerLength);let f=0;if(i===.1){n=n.uint16("fps").uint16("_frames");f=6}else if(i===.2){n=n.floatle("fps").uint32("_frames");f=10}else{throw new Error(`Invalid version ${i}`)}n=n.uint16("_people");const o=n.parse(e);const h=(t,i)=>{const r=new DataView(e.buffer,e.byteOffset,e.length);let s=i;const n={data:new Float32Array(t),offset:0};for(let t=0;t<n.data.length;t++){let e=r.getFloat32(s,true);s+=4;n.data[t]=e}n.offset=s;return n};const a=h(o._frames*o._people*r*s,t.headerLength+f);const u=h(o._frames*o._people*r,a.offset);function c(e){const i=new Array(o._people);for(let n=0;n<o._people;n++){const f={};i[n]=f;let h=0;t.components.forEach((t=>{f[t.name]=[];for(let i=0;i<t.points.length;i++){const c=e*(o._people*r)+n*r;const l=c+h+i;const b={C:u.data[l]};[...t.format].forEach(((t,e)=>{if(t!=="C"){b[t]=a.data[l*s+e]}}));f[t.name].push(b)}h+=t.points.length}))}return{people:i}}const l=new Proxy({},{get:function(t,e){if(e==="length"){return o._frames}return c(e)}});return Object.assign(Object.assign({},o),{frames:l})}const _t=Mt();function It(t){const e=_t.parse(t);let i;const r=Math.round(e.version*1e3)/1e3;switch(r){case 0:i=Rt(e,t);break;case.1:case.2:i=Ut(e,t,r);break;default:throw new Error("Parsing this body version is not implemented - "+e.version)}return{header:e,body:i}}const Tt={};const Vt=Object.freeze({__proto__:null,default:Tt});class jt{constructor(t,e){this.header=t;this.body=e}static from(t){const e=It(t);return new jt(e.header,e.body)}static async fromLocal(t){const e=undefined(t);return jt.from(e)}static async fromRemote(t,e){var i;const r={};if(e){r.signal=e.signal}const s=await fetch(t,r);if(!s.ok){let t=(i=s.statusText)!==null&&i!==void 0?i:String(s.status);try{const e=await s.json();t=e.message}catch(t){}throw new Error(t)}const n=E.from(await s.arrayBuffer());return jt.from(n)}}class St{constructor(t){this.viewer=t}x(t){const e=t*(this.viewer.elWidth-2*this.viewer.elPadding.width);return e/this.viewer.pose.header.width+this.viewer.elPadding.width}y(t){const e=t*(this.viewer.elHeight-2*this.viewer.elPadding.height);return e/this.viewer.pose.header.height+this.viewer.elPadding.height}isJointValid(t){return t.C>0}renderJoints(t,e){return t.filter(this.isJointValid.bind(this)).map(((t,i)=>this.renderJoint(i,t,e[i%e.length])))}renderLimbs(t,e,i){const r=t.map((({from:t,to:r})=>{const s=e[t];const n=e[r];if(!this.isJointValid(s)||!this.isJointValid(n)){return null}const f=i[t%i.length];const o=i[r%i.length];const h={R:(f.R+o.R)/2,G:(f.G+o.G)/2,B:(f.B+o.B)/2};return{from:s,to:n,color:h,z:(s.Z+n.Z)/2}}));return r.filter(Boolean).sort(((t,e)=>t.z-e.z)).map((({from:t,to:e,color:i})=>this.renderLimb(t,e,i)))}renderFrame(t){return t.people.map((t=>this.viewer.pose.header.components.map((e=>{const i=t[e.name];return[this.renderJoints(i,e.colors),this.renderLimbs(e.limbs,i,e.colors)]}))))}}class Ot extends St{renderJoint(e,i,r){const{R:s,G:n,B:f}=r;return t("circle",{cx:i.X,cy:i.Y,r:4,class:"joint draggable",style:{fill:`rgb(${s}, ${n}, ${f})`,opacity:String(i.C)},"data-id":e})}renderLimb(e,i,r){const{R:s,G:n,B:f}=r;return t("line",{x1:e.X,y1:e.Y,x2:i.X,y2:i.Y,style:{stroke:`rgb(${s}, ${n}, ${f})`,opacity:String((e.C+i.C)/2)}})}render(e){const i=`0 0 ${this.viewer.pose.header.width} ${this.viewer.pose.header.height}`;return t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:i,width:this.viewer.elWidth,height:this.viewer.elHeight},t("g",null,this.renderFrame(e)))}}class Ct extends St{renderJoint(t,e,i){const{R:r,G:s,B:n}=i;this.ctx.strokeStyle=`rgba(0, 0, 0, 0)`;this.ctx.fillStyle=`rgba(${r}, ${s}, ${n}, ${e.C})`;const f=Math.round(this.thickness/3);this.ctx.beginPath();this.ctx.arc(this.x(e.X),this.y(e.Y),f,0,2*Math.PI);this.ctx.fill();this.ctx.stroke()}renderLimb(t,e,i){const{R:r,G:s,B:n}=i;this.ctx.lineWidth=this.thickness*5/4;this.ctx.strokeStyle=`rgba(${r}, ${s}, ${n}, ${(t.C+e.C)/2})`;this.ctx.beginPath();this.ctx.moveTo(this.x(t.X),this.y(t.Y));this.ctx.lineTo(this.x(e.X),this.y(e.Y));this.ctx.stroke()}render(e){const i=()=>{var t;const i=this.viewer.element.shadowRoot.querySelector("canvas");if(i){i.width=this.viewer.elWidth;i.height=this.viewer.elHeight;this.ctx=i.getContext("2d");if(this.viewer.background){this.ctx.fillStyle=this.viewer.background;this.ctx.fillRect(0,0,i.width,i.height)}else{this.ctx.clearRect(0,0,i.width,i.height)}const r=this.viewer.elWidth-2*this.viewer.elPadding.width;const s=this.viewer.elHeight-2*this.viewer.elPadding.height;this.thickness=(t=this.viewer.thickness)!==null&&t!==void 0?t:Math.round(Math.sqrt(r*s)/150);this.renderFrame(e)}else{throw new Error("Canvas isn't available before first render")}};try{i()}catch(t){requestAnimationFrame(i)}return t("canvas",{width:this.viewer.elWidth,height:this.viewer.elHeight})}}const Ft=":host{display:inline-block}svg,canvas{max-width:100%}svg circle{stroke:black;stroke-width:1px;opacity:0.8}svg line{stroke-width:8px;opacity:0.8;stroke:black}canvas{display:block}";const Dt=class{constructor(t){e(this,t);this.canplaythrough$=i(this,"canplaythrough$",7);this.ended$=i(this,"ended$",7);this.loadeddata$=i(this,"loadeddata$",7);this.loadedmetadata$=i(this,"loadedmetadata$",7);this.loadstart$=i(this,"loadstart$",7);this.pause$=i(this,"pause$",7);this.play$=i(this,"play$",7);this.firstRender$=i(this,"firstRender$",7);this.render$=i(this,"render$",7);this.hasRendered=false;this.src=undefined;this.svg=false;this.width=null;this.height=null;this.aspectRatio=null;this.padding=null;this.thickness=null;this.background=null;this.loop=false;this.autoplay=true;this.playbackRate=1;this.currentTime=NaN;this.duration=NaN;this.ended=false;this.paused=true;this.readyState=0;this.error=undefined}componentWillLoad(){this.renderer=this.svg?new Ot(this):new Ct(this);return this.srcChange()}componentDidLoad(){this.resizeObserver=new ResizeObserver(this.setDimensions.bind(this));this.resizeObserver.observe(this.element)}async getRemotePose(){if(this.fetchAbortController){this.fetchAbortController.abort()}this.fetchAbortController=new AbortController;this.pose=await jt.fromRemote(this.src,this.fetchAbortController)}initPose(){this.setDimensions();this.loadedmetadata$.emit();this.loadeddata$.emit();this.canplaythrough$.emit();this.duration=(this.pose.body.frames.length-1)/this.pose.body.fps;this.currentTime=0;if(this.autoplay){this.play()}}async srcChange(){if(this.src===this.lastSrc){return}this.lastSrc=this.src;this.clearInterval();this.setDimensions();delete this.pose;this.currentTime=NaN;this.duration=NaN;this.hasRendered=false;if(!this.src){return}this.ended=false;this.loadstart$.emit();this.error=null;try{await this.getRemotePose();this.initPose();this.error=null}catch(t){console.error("PoseViewer error",t);this.error=t}}setDimensions(){this.elPadding={width:0,height:0};if(!this.pose){this.elWidth=0;this.elHeight=0;return}if(!this.width&&!this.height){this.elWidth=this.pose.header.width;this.elHeight=this.pose.header.height;return}const t=this.element.getBoundingClientRect();const e=(t,e)=>t.endsWith("px")?Number(t.slice(0,-2)):t.endsWith("%")?e*t.slice(0,-1)/100:Number(t);if(this.width&&this.height){this.elWidth=e(this.width,t.width);this.elHeight=e(this.height,t.height)}else if(this.width){this.elWidth=e(this.width,t.width);this.elHeight=this.aspectRatio?this.elWidth*this.aspectRatio:this.pose.header.height/this.pose.header.width*this.elWidth}else if(this.height){this.elHeight=e(this.height,t.height);this.elWidth=this.aspectRatio?this.elHeight/this.aspectRatio:this.pose.header.width/this.pose.header.height*this.elHeight}if(this.padding){this.elPadding.width+=e(this.padding,this.elWidth);this.elPadding.height+=e(this.padding,this.elHeight)}const i=this.elWidth-this.elPadding.width*2;const r=this.elHeight-this.elPadding.height*2;const s=i/r;const n=this.pose.header.width/this.pose.header.height;if(n>s){this.elPadding.height+=(n-s)*r/2}else{this.elPadding.width+=(s-n)*i/2}}async syncMedia(t){this.media=t;this.media.addEventListener("pause",this.pause.bind(this));this.media.addEventListener("play",this.play.bind(this));const e=()=>this.currentTime=this.frameTime(this.media.currentTime);this.media.addEventListener("seek",e);this.media.addEventListener("timeupdate",e);const i=()=>this.playbackRate=this.media.playbackRate;this.media.addEventListener("ratechange",i);i();this.clearInterval();if(this.media.paused){this.pause()}else{this.play()}}async getPose(){return this.pose}async nextFrame(){const t=this.currentTime+1/this.pose.body.fps;if(t>this.duration){if(this.loop){this.currentTime=t%this.duration}else{this.ended$.emit();this.ended=true}}else{this.currentTime=t}}frameTime(t){if(!this.pose){return 0}return Math.floor(t*this.pose.body.fps)/this.pose.body.fps}async play(){if(!this.paused){this.clearInterval()}this.paused=false;this.play$.emit();if(this.currentTime>this.duration){this.currentTime=0}const t=1e3/(this.pose.body.fps*this.playbackRate);if(this.media){this.loopInterval=setInterval((()=>this.currentTime=this.frameTime(this.media.currentTime)),t)}else{let e=Date.now()/1e3;this.loopInterval=setInterval((()=>{const t=Date.now()/1e3;this.currentTime+=(t-e)*this.playbackRate;e=t;if(this.currentTime>this.duration){if(this.loop){this.currentTime=this.currentTime%this.duration}else{this.ended$.emit();this.ended=true;this.clearInterval()}}}),t)}}async pause(){this.paused=true;this.pause$.emit();this.clearInterval()}clearInterval(){if(this.loopInterval){clearInterval(this.loopInterval)}}disconnectedCallback(){this.clearInterval()}render(){if(this.error){return this.error.name!=="AbortError"?this.error.message:""}if(!this.pose||isNaN(this.currentTime)||!this.renderer){return""}const e=this.currentTime>this.duration?this.duration:this.currentTime;const i=Math.floor(e*this.pose.body.fps);const r=this.pose.body.frames[i];const n=this.renderer.render(r);if(!this.hasRendered){requestAnimationFrame((()=>{this.hasRendered=true;this.firstRender$.emit()}))}requestAnimationFrame((()=>this.render$.emit()));return t(s,null,n)}get element(){return r(this)}static get watchers(){return{src:["srcChange"]}}};Dt.style=Ft;export{Dt as pose_viewer};
//# sourceMappingURL=p-8fe26eae.entry.js.map